!function (e) { e.selectator = function (t, s) { var i = { prefix: "selectator_", height: "auto", useDimmer: !1, useSearch: !0, showAllOptionsOnFocus: !1, selectFirstOptionOnSearch: !0, keepOpen: !1, searchCallback: function () { }, labels: { search: "Search..." } }, n = this; n.settings = {}; var a = e(t), o = null, r = null, l = null, d = null, c = null, p = void 0 !== a.attr("multiple"), h = p ? -1 : 0, u = { backspace: 8, enter: 13, escape: 27, left: 37, up: 38, right: 39, down: 40 }; n.init = function () { if (n.settings = e.extend({}, i, s), n.settings.useDimmer && 0 === e("#" + n.settings.prefix + "dimmer").length) { var t = e(document.createElement("div")); t.attr("id", n.settings.prefix + "dimmer"), t.hide(), e(document.body).prepend(t) } o = e(document.createElement("div")), void 0 !== a.attr("id") && o.attr("id", n.settings.prefix + a.attr("id")), o.addClass("selectator " + (p ? "multiple " : "single ") + "options-hidden"), n.settings.useSearch || o.addClass("disable_search"), o.css({ width: a.css("width"), minHeight: a.css("height"), padding: a.css("padding"), "flex-grow": a.css("flex-grow"), position: "relative" }), "element" === n.settings.height && o.css({ height: a.outerHeight() + "px" }), a.after(o), a.hide(), d = e(document.createElement("span")), d.addClass(n.settings.prefix + "textlength"), d.css({ position: "absolute", visibility: "hidden" }), o.append(d), r = e(document.createElement("div")), r.addClass(n.settings.prefix + "chosen_items"), o.append(r), l = e(document.createElement("input")), l.addClass(n.settings.prefix + "input"), n.settings.useSearch ? p ? l.width(20) : l.attr("placeholder", n.settings.labels.search) : (l.attr("readonly", !0), l.css({ width: "0px", height: "0px", overflow: "hidden", border: 0, padding: 0, position: "absolute" })), l.attr("autocomplete", "false"), o.append(l), c = e(document.createElement("ul")), c.addClass(n.settings.prefix + "options"), o.append(c), a.change(function () { g() }), o.on("focus", function (e) { e.preventDefault(), e.stopPropagation(), C(), l.focus() }), o.on("mousedown", function (e) { if (e.preventDefault(), e.stopPropagation(), l.focus(), l[0].setSelectionRange) l.focus(), l[0].setSelectionRange(l.val().length, l.val().length); else if (l[0].createTextRange) { var t = l[0].createTextRange(); t.collapse(!0), t.moveEnd("character", l.val().length), t.moveStart("character", l.val().length), t.select() } }), o.on("mouseup", function (e) { e.preventDefault(), e.stopPropagation() }), o.on("click", function (e) { e.preventDefault(), e.stopPropagation(), p && !n.settings.showAllOptionsOnFocus && n.settings.useSearch || m(), l.focus() }), o.on("dblclick", function (e) { e.preventDefault(), e.stopPropagation(), l.focus(), l.select() }), l.on("click", function (e) { e.preventDefault(), e.stopPropagation() }), l.on("dblclick", function (e) { e.preventDefault(), e.stopPropagation() }), l.on("keydown", function (e) { e.stopPropagation(); var t = e.keyCode || e.which; switch (t) { case u.up: e.preventDefault(), h > (p ? -1 : 0) ? h -= 1 : h = c.find("." + n.settings.prefix + "option").length - 1, w(), D(); break; case u.down: e.preventDefault(), h < c.find("." + n.settings.prefix + "option").length - 1 ? h += 1 : h = p ? -1 : 0, w(), D(); break; case u.escape: e.preventDefault(); break; case u.enter: e.preventDefault(), -1 !== h ? E() : "" !== l.val() && n.settings.searchCallback(l.val()), f(); break; case u.backspace: "" === l.val() && (a.find("option:selected").last()[0].selected = !1, a.trigger("change"), g(), m()), f(); break; default: f() } }), l.on("keyup", function (e) { e.preventDefault(), e.stopPropagation(); var t = e.keyCode || e.which; t === u.escape ? b() : t === u.enter ? n.settings.keepOpen || b() : (37 > t || t > 40) && m(), !o.hasClass("options-hidden") || t !== u.left && t !== u.right && t !== u.up && t !== u.down || m(), f() }), l.on("focus", function (e) { e.preventDefault(), e.stopPropagation(), c.is(":empty") && p && !n.settings.showAllOptionsOnFocus && n.settings.useSearch || (m(), C()) }), l.on("blur", function (e) { e.preventDefault(), e.stopPropagation(), b() }), g() }; var f = function () { d.text(l.val()), p && l.css({ width: d.width() + 20 + "px" }) }; n.refresh = function () { g() }; var g = function () { r.empty(), a.find("option").each(function () { var t = e(this); if (this.selected) { var s = e(document.createElement("div")); if (s.addClass(n.settings.prefix + "chosen_item"), void 0 !== t.attr("class") && s.addClass(t.attr("class")), void 0 !== t.data("left")) { var i = e(document.createElement("div")); i.addClass(n.settings.prefix + "chosen_item_left").html(t.attr("data-left")), s.append(i) } if (void 0 !== t.data("right")) { var o = e(document.createElement("div")); o.addClass(n.settings.prefix + "chosen_item_right").html(t.attr("data-right")), s.append(o) } var l = e(document.createElement("div")); if (l.addClass(n.settings.prefix + "chosen_item_title").html(t.html()), s.append(l), void 0 !== t.data("subtitle")) { var d = e(document.createElement("div")); d.addClass(n.settings.prefix + "chosen_item_subtitle").html(t.attr("data-subtitle")), s.append(d) } var c = e(document.createElement("div")); c.data("element", this), c.addClass(n.settings.prefix + "chosen_item_remove"), c.on("mousedown", function (e) { e.preventDefault(), e.stopPropagation() }), c.on("mouseup", function (t) { t.preventDefault(), t.stopPropagation(), e(this).data("element").selected = !1, a.trigger("change"), g() }), c.html("X"), s.append(c); var p = e(document.createElement("div")); p.css("clear", "both"), s.append(p), r.append(s) } }), m() }, m = function () { if (h = n.settings.selectFirstOptionOnSearch && "" !== l.val().replace(/\s/g, "") ? 0 : -1, c.empty(), "" !== l.val().replace(/\s/g, "") || !p || n.settings.showAllOptionsOnFocus || !n.settings.useSearch) { var t = []; a.children().each(function () { if ("optgroup" === e(this).prop("tagName").toLowerCase()) { var s = e(this); if (0 !== s.children("option").length) { var i = !1; if (s.children("option").each(function () { this.selected && p || -1 === e(this).html().toLowerCase().indexOf(l.val().toLowerCase()) || (i = !0) }), i) { var n = []; s.children("option").each(function () { this.selected && p || -1 === e(this).html().toLowerCase().indexOf(l.val().toLowerCase()) || n.push({ type: "option", text: e(this).html(), element: this }) }), t.push({ type: "group", text: s.attr("label"), options: n, element: s }) } } } else -1 !== e(this).html().toLowerCase().indexOf(l.val().toLowerCase()) && (this.selected && p || t.push({ type: "option", text: e(this).html(), element: this })) }), v(t) } l.is(":focus") ? c.is(":empty") && p ? b() : C() : b() }, v = function (t) { var s = -1; e(t).each(function () { if ("group" === this.type) { var t = e(document.createElement("li")); t.addClass(n.settings.prefix + "group_header"), void 0 !== e(this.element).attr("class") && t.addClass(e(this.element).attr("class")), t.html(e(this.element).attr("label")), c.append(t); var i = e(document.createElement("ul")); void 0 !== e(this).attr("class") && i.addClass(e(this).attr("class")), i.addClass(n.settings.prefix + "group"), c.append(i), e(this.options).each(function () { s++; var e = x.call(this.element, s); i.append(e) }), c.append(i) } else { s++; var a = x.call(this.element, s); c.append(a) } }), w() }, x = function (t) { var s = e(document.createElement("li")); if (s.data("index", t), s.data("element", this), s.addClass(n.settings.prefix + "option"), this.selected && s.addClass("active"), void 0 !== e(this).attr("class") && s.addClass(e(this).attr("class")), void 0 !== e(this).data("left")) { var i = e(document.createElement("div")); i.addClass(n.settings.prefix + "option_left").html(e(this).attr("data-left")), s.append(i) } if (void 0 !== e(this).data("right")) { var a = e(document.createElement("div")); a.addClass(n.settings.prefix + "option_right").html(e(this).attr("data-right")), s.append(a) } var o = e(document.createElement("div")); if (o.addClass(n.settings.prefix + "option_title").html(e(this).html()), s.append(o), void 0 !== e(this).data("subtitle")) { var r = e(document.createElement("div")); r.addClass(n.settings.prefix + "option_subtitle").html(e(this).attr("data-subtitle")), s.append(r) } var l = e(document.createElement("div")); return l.css("clear", "both"), s.append(l), s.on("mouseover", function (e) { e.preventDefault(), e.stopPropagation(), h = t, w() }), s.on("mousedown", function (e) { e.preventDefault(), e.stopPropagation() }), s.on("mouseup", function (e) { e.preventDefault(), e.stopPropagation(), E() }), s.on("click", function (e) { e.preventDefault(), e.stopPropagation() }), s }, C = function () { o.removeClass("options-hidden").addClass("options-visible"), n.settings.useDimmer && e("#" + n.settings.prefix + "dimmer").show(), setTimeout(function () { c.css("top", o.outerHeight() + (p ? 0 : l.outerHeight()) - 2 + "px") }, 1), o.hasClass("single") && (h = c.find("." + n.settings.prefix + "option").index(c.find("." + n.settings.prefix + "option.active"))), D() }, b = function () { o.removeClass("options-visible").addClass("options-hidden"), n.settings.useDimmer && e("#" + n.settings.prefix + "dimmer").hide() }, w = function () { c.find(".active").removeClass("active"), -1 !== h && c.find("." + n.settings.prefix + "option").eq(h).addClass("active") }, D = function () { var e = c.find("." + n.settings.prefix + "option.active"); e.length > 0 && c.scrollTop(c.scrollTop() + e.position().top - c.height() / 2 + e.height() / 2) }, E = function () { c.find("." + n.settings.prefix + "option").eq(h).data("element").selected = !0, a.trigger("change"), g(), l.val(""), n.settings.keepOpen || b() }; n.destroy = function () { o.remove(), e.removeData(t, "selectator"), a.show(), 0 === e(".selectator").length && e("#" + n.settings.prefix + "dimmer").remove() }, n.init() }, e.fn.selectator = function (t) { return t = void 0 !== t ? t : {}, this.each(function () { if ("object" == typeof t) { if (void 0 === e(this).data("selectator")) { var s = new e.selectator(this, t); e(this).data("selectator", s) } } else e(this).data("selectator")[t] ? e(this).data("selectator")[t].apply(this, Array.prototype.slice.call(arguments, 1)) : e.error("Method " + t + " does not exist in $.selectator") }) } }(jQuery);